--CREATE DATABASE STUDENT_MANAGEMENT;

--==============================================================CRIANDO AS SEQUENCES=========================================================--

CREATE SEQUENCE SEQ_SM_ALUNO
    INCREMENT 1
    MINVALUE 1 
    MAXVALUE 99999999999
    START 1
    CACHE 1 
;

CREATE SEQUENCE SEQ_SM_MATRICULA
    INCREMENT 1
    MINVALUE 1 
    MAXVALUE 99999999999
    START 1
    CACHE 1 
;

CREATE SEQUENCE SEQ_SM_FALTA
    INCREMENT 1
    MINVALUE 1 
    MAXVALUE 99999999999
    START 1
    CACHE 1 
;

CREATE SEQUENCE SEQ_SM_PRESENCA
    INCREMENT 1
    MINVALUE 1 
    MAXVALUE 99999999999
    START 1
    CACHE 1 
;

CREATE SEQUENCE SEQ_SM_NOTA
    INCREMENT 1
    MINVALUE 1 
    MAXVALUE 99999999999
    START 1
    CACHE 1 
;

CREATE SEQUENCE SEQ_SM_CURSO
    INCREMENT 1
    MINVALUE 1 
    MAXVALUE 99999999999
    START 1
    CACHE 1 
;

CREATE SEQUENCE SEQ_SM_DISCIPLINA
    INCREMENT 1
    MINVALUE 1 
    MAXVALUE 99999999999
    START 1
    CACHE 1 
;

CREATE SEQUENCE SEQ_SM_PROFESSOR
    INCREMENT 1
    MINVALUE 1 
    MAXVALUE 99999999999
    START 1
    CACHE 1 
;

CREATE SEQUENCE SEQ_SM_FORUM
    INCREMENT 1
    MINVALUE 1 
    MAXVALUE 99999999999
    START 1
    CACHE 1 
;

CREATE SEQUENCE SEQ_SM_GRADE
    INCREMENT 1
    MINVALUE 1 
    MAXVALUE 99999999999
    START 1
    CACHE 1 
;

CREATE SEQUENCE SEQ_SM_COMENTARIO
    INCREMENT 1
    MINVALUE 1 
    MAXVALUE 99999999999
    START 1
    CACHE 1 
;


--================================================================CRIANDO AS TABELAS==============================================================--


CREATE TABLE SM_ALUNO (
    ID_ALUNO INTEGER DEFAULT NEXTVAL('SEQ_SM_ALUNO'),
    RA NUMERIC UNIQUE NOT NULL,
    NOME VARCHAR(80) NOT NULL,
    EMAIL VARCHAR(70) UNIQUE NOT NULL,
    DOCUMENTO CHAR(11) UNIQUE NOT NULL,
    TELEFONE CHAR(15) NOT NULL,
    ENDERECO VARCHAR(255) NOT NULL,
    DATA_NASC DATE NOT NULL,
    STATUS CHAR(30) DEFAULT 'ATIVO',
    CREATED_AT TIMESTAMP DEFAULT NOW(),
    UPDATED_AT TIMESTAMP DEFAULT NOW(),
    PRIMARY KEY(ID_ALUNO) 
);

CREATE TABLE SM_CURSO (
    ID_CURSO INTEGER DEFAULT NEXTVAL('SEQ_SM_CURSO'),
    TITULO VARCHAR(255) NOT NULL,
    TIPO CHAR(20) NOT NULL,
    REGIME CHAR(20) NOT NULL,
    TURNO CHAR(20) NOT NULL,
    PERIODICIDADE CHAR(20) NOT NULL,
    PRIMARY KEY(ID_CURSO) 
);

CREATE TABLE SM_GRADE (
    ID_GRADE INTEGER DEFAULT NEXTVAL('SEQ_SM_GRADE'),
    ID_CURSO INTEGER REFERENCES SM_CURSO(ID_CURSO) UNIQUE NOT NULL,
    CARGA_HORARIA NUMERIC NOT NULL,
    PRIMARY KEY(ID_GRADE) 
);

CREATE TABLE SM_MATRICULA (
    ID_MATRICULA INTEGER DEFAULT NEXTVAL('SEQ_SM_MATRICULA'),
    ID_CURSO INTEGER REFERENCES SM_CURSO(ID_CURSO) NOT NULL,
    ID_ALUNO INTEGER REFERENCES SM_ALUNO(ID_ALUNO) NOT NULL,
    DATA_ABERTURA DATE NOT NULL,
    STATUS CHAR(30) DEFAULT 'ATIVA',
    PRIMARY KEY(ID_MATRICULA) 
);

CREATE TABLE SM_PROFESSOR (
    ID_PROFESSOR INTEGER DEFAULT NEXTVAL('SEQ_SM_PROFESSOR'),
    NOME VARCHAR(80) NOT NULL,
    EMAIL VARCHAR(80) UNIQUE NOT NULL,
    TELEFONE VARCHAR(15) NOT NULL,
    URL_CURRICULO VARCHAR(500) NOT NULL,
    PRIMARY KEY(ID_PROFESSOR) 
);

CREATE TABLE SM_DISCIPLINA (
    ID_DISCIPLINA INTEGER DEFAULT NEXTVAL('SEQ_SM_DISCIPLINA'),
    ID_PROFESSOR INTEGER REFERENCES SM_PROFESSOR(ID_PROFESSOR) NOT NULL,
    NOME VARCHAR(255) NOT NULL,
    REQUISITO VARCHAR(255) DEFAULT 'NENHUM',
    PRIMARY KEY(ID_DISCIPLINA) 
);

CREATE TABLE SM_FORUM (
    ID_FORUM INTEGER DEFAULT NEXTVAL('SEQ_SM_FORUM'),
    ID_PROFESSOR INTEGER REFERENCES SM_PROFESSOR(ID_PROFESSOR) NOT NULL,
    ID_DISCIPLINA INTEGER REFERENCES SM_DISCIPLINA(ID_DISCIPLINA) NOT NULL,
    CARGA_HORARIA NUMERIC NOT NULL,
    TEMA VARCHAR(255) NOT NULL,
    PRIMARY KEY(ID_FORUM) 
);

CREATE TABLE SM_COMENTARIO (
    ID_COMENTARIO INTEGER DEFAULT NEXTVAL('SEQ_SM_COMENTARIO'),
    ID_FORUM INTEGER REFERENCES SM_FORUM(ID_FORUM) NOT NULL,
    ID_ALUNO INTEGER REFERENCES SM_ALUNO(ID_ALUNO) NOT NULL,
    COMENTARIO VARCHAR(500),
    PRIMARY KEY(ID_COMENTARIO) 
);

CREATE TABLE SM_PRESENCA (
    ID_PRESENCA INTEGER DEFAULT NEXTVAL('SEQ_SM_PRESENCA'),
    ID_DISCIPLINA INTEGER REFERENCES SM_DISCIPLINA(ID_DISCIPLINA) NOT NULL,
    ID_ALUNO INTEGER REFERENCES SM_ALUNO(ID_ALUNO) NOT NULL,
    DATA_AULA DATE,
    PRIMARY KEY(ID_PRESENCA) 
);

CREATE TABLE SM_FALTA (
    ID_FALTA INTEGER DEFAULT NEXTVAL('SEQ_SM_FALTA'),
    ID_DISCIPLINA INTEGER REFERENCES SM_DISCIPLINA(ID_DISCIPLINA) NOT NULL,
    ID_ALUNO INTEGER REFERENCES SM_ALUNO(ID_ALUNO) NOT NULL,
    DATA_AULA DATE,
    PRIMARY KEY(ID_FALTA) 
);

CREATE TABLE SM_NOTA (
    ID_NOTA INTEGER DEFAULT NEXTVAL('SEQ_SM_NOTA'),
    ID_DISCIPLINA INTEGER REFERENCES SM_DISCIPLINA(ID_DISCIPLINA) NOT NULL,
    ID_ALUNO INTEGER REFERENCES SM_ALUNO(ID_ALUNO) NOT NULL,
    PERIODO NUMERIC(2,0),
    TIPO_NOTA CHAR(30) DEFAULT 'NORMAL',--DIFERENCIAR DE NOTA DE EXAME
    VALOR NUMERIC,
    BIMESTRE NUMERIC,
    PRIMARY KEY(ID_NOTA) 
);

--TABELAS ASSOCIATIVAS

CREATE TABLE SM_GRADE_DISCIPLINA (
    ID_GRADE INTEGER REFERENCES SM_GRADE(ID_GRADE) NOT NULL,
    ID_DISCIPLINA INTEGER REFERENCES SM_DISCIPLINA(ID_DISCIPLINA) NOT NULL,
    PERIODO NUMERIC(2,0),
    CATEGORIA VARCHAR(255),
    ATIVIDADE CHAR(20),
    CARGA_HORARIA NUMERIC NOT NULL
);

CREATE TABLE SM_MATRICULA_DISCIPLINA (
    ID_MATRICULA INTEGER REFERENCES SM_MATRICULA(ID_MATRICULA) NOT NULL,
    ID_DISCIPLINA INTEGER REFERENCES SM_DISCIPLINA(ID_DISCIPLINA) NOT NULL,
    PERIODO NUMERIC(2,0),
    STATUS CHAR(30) DEFAULT 'REALIZANDO'
);

CREATE TABLE SM_ALUNO_FORUM (
    ID_ALUNO INTEGER REFERENCES SM_ALUNO(ID_ALUNO) NOT NULL,
    ID_FORUM INTEGER REFERENCES SM_FORUM(ID_FORUM) NOT NULL
);
